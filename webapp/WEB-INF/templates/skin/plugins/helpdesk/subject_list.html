<#macro subjectsList items typeList depth>
	<#if items?has_content >
		<ul id="${typeList}">
			<#list items as subject >
				<li>
					<#if typeList != "subject">
						<#if typeList != "subject">
							<a class="top" href="jsp/site/Portal.jsp?page=${path_label}&faq_id=${faq.id}#top">#i18n{helpdesk.question_list_row.top}</a>
						</#if>
						<a name="${anchor_subject}${subject.id}"></a>${subject.text}
						<ul id="${typeList}">
							<#list subject.questions as questionAnswer >
								<#if questionAnswer.enabled == true >
									<li>
										<a name="${anchor_question_answer}${questionAnswer.idQuestionAnswer}"></a>
										<strong>${questionAnswer.question}</strong>
										<blockquote>${questionAnswer.answer}</blockquote>
									</li>
								</#if>
							</#list>
						</ul>
					<#else>
						<a class="helpdesk-subject" href="jsp/site/Portal.jsp?page=${path_label}&faq_id=${faq.id}#${anchor_subject}${subject.id}">${subject.text}</a>
					</#if>
			        <#assign child_subjects_list = subject.getChilds(plugin) />
			        <#if child_subjects_list?has_content>
	       				<@subjectsList items=child_subjects_list typeList=typeList depth=depth+1 />
			        </#if>
		        </li>
			</#list>
		</ul>
	</#if>
</#macro>

<#macro subjectsListSelect items default_value exclude_value depth>
	<#if items?has_content >
	<#list items as subject >
		<#if exclude_value="${subject.id}">
		<#else>
			<option <#if default_value="${subject.id}">selected="selected"</#if> value="${subject.id}" >
			<#if depth &gt; 0><#list 1..depth as i>&nbsp;&nbsp;</#list></#if>${subject.text}</option>
	        <#assign child_subjects_list = subject.getChilds(plugin) />
	        <#if child_subjects_list?has_content>
				<@subjectsListSelect items=child_subjects_list default_value=default_value exclude_value=exclude_value depth=depth+1 />
	        </#if>
        </#if>
	</#list>
	
	</#if>
</#macro>

<#macro getParentSubject subject breadcrumb >
	<#if subject?has_content>
		<#if breadcrumb == "">
			<#assign breadcrumbCopy = subject.text />
		<#else>
			<#assign breadcrumbCopy = subject.text + " &gt; " + breadcrumb />
		</#if>
		<#if subject.getParent(plugin)?has_content && subject.idParent != 0 >
			<@getParentSubject subject=subject.getParent(plugin) breadcrumb=breadcrumbCopy />
		<#else>
			<a class="top" href="jsp/site/Portal.jsp?page=${path_label}&faq_id=${faq.id}#top">#i18n{helpdesk.question_list_row.top}</a>
			${breadcrumbCopy}
		</#if>
	</#if>
</#macro>

<div id="content" class="span-22 prepend-1 append-1 append-bottom last">
	<div class="portlet -lutece-border-radius">
		<a name="top"></a>
		<h2 class="page-title">#i18n{helpdesk.subject_list.pageTitle}</h2>
		<form class="default-form" name="form_search" method="post">
			<fieldset>
				<label class="text-label" for="form_search_keywords">#i18n{helpdesk.subject_list.labelSearch} : </label>
				<input type="text" size="30" id="form_search_keywords" name="form_search_keywords" value="${filter_searched_keywords?html}" class="-lutece-input -lutece-border-radius-mini" />
				<br/>
				<label class="text-label" for="">&nbsp;</label>
				<em>#i18n{helpdesk.subject_list.labelInfoSearch}</em>
				<br />
				<label class="text-label" for="form_search_date_begin">#i18n{helpdesk.subject_list.labelDateBegin} : </label>
				<input type="text" class="dateRange" size="10" id="form_search_date_begin" name="form_search_date_begin" value="${filter_date_begin?html}" />
				#i18n{helpdesk.subject_list.labelDateEnd} : 
				<input type="text" class="dateRange" size="10" id="form_search_date_end" name="form_search_date_end" value="${filter_date_end?html}" />
				<br />
				<label class="text-label" for="form_search_subject_id">#i18n{helpdesk.subject_list.labelSubject} : </label>
				<select id="form_search_subject_id" name="form_search_subject_id" class="-lutece-input -lutece-border-radius-mini" >
					<option value=""></option>
					<@subjectsListSelect items=helpdesk_subject_list default_value="${filter_subject_id}" exclude_value="" depth=0 />
				</select>
				<input type="checkbox" name="form_search_sub_subjects" id="form_search_sub_subjects" value="true" <#if filter_search_sub_subject>checked="checked"</#if> />#i18n{helpdesk.subject_list.labelSearchSubSubjects}
				<p class="buttons">
					<input type="hidden" name="page" value="${path_label}" />
					<input type="hidden" value="${faq.id}" name="faq_id" />
					<input id="button-search" class="-lutece-input -lutece-border-radius-mini" type="submit" name="form_search_submit" value="#i18n{helpdesk.subject_list.buttonLabelSearch}" />
				</p>
			</fieldset>
		</form>
		<p>
			<a href="jsp/site/Portal.jsp?page=${path_label}&faq_id=${faq.id}">#i18n{helpdesk.subject_list.labelList}</a>
		</p>
		<form method="post">
			<input type="hidden" name="page" value="${path_label}" />
			<input type="hidden" name="faq_id" value="${faq.id}" />
			<input type="hidden" name="contact" value="contact" />
			#i18n{helpdesk.subject_list.labelNoAnswer}
			<input type="submit" value="#i18n{helpdesk.subject_list.labelContact}" class="-lutece-button" />
		</form>
		<#if search_page>
			<#if helpdesk_question_answer_list?has_content>
				<ul id="questionAnswer">
					<#list helpdesk_question_answer_list as questionAnswer>
						<li>
						<@getParentSubject subject=questionAnswer.getSubject(plugin) breadcrumb="" />
						<br />
						<a name="${questionAnswer.idQuestionAnswer}"></a>
						<strong>${questionAnswer.question}</strong>
						<blockquote>${questionAnswer.answer}</blockquote>
						</li>
					</#list>
				</ul>
			<#else>
				<blockquote>#i18n{helpdesk.message.search_nok}</blockquote>
			</#if>
		<#else>
			<div class="portlet-background">
				<@subjectsList items=helpdesk_subject_list typeList="subject" depth=0 />
			</div>
			<@subjectsList items=helpdesk_subject_list typeList="questionAnswer" depth=0 />
		</#if>
		<form method="post">
			<input type="hidden" name="page" value="${path_label}" />
			<input type="hidden" name="faq_id" value="${faq.id}" />
			<input type="hidden" name="contact" value="contact" />
			#i18n{helpdesk.subject_list.labelNoAnswer}
			<input type="submit" value="#i18n{helpdesk.subject_list.labelContact}" class="-lutece-button" />
		</form>
	</div>
</div>

<@getDatePickerRange idFieldFrom="form_search_date_begin" idFieldTo="form_search_date_end" language=locale.language />
